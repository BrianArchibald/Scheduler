<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Booking Page</title>
	<link rel="stylesheet" type="text/css" href="main.css">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU"
	 crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
		<script
	  src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
	  integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
	  crossorigin="anonymous"></script>
</head>

<body>
	<div class="booking-wrapper">
		<div class="booking-title">
			<p>Choose Your Time to Meet</p>
		</div>
		<div class="booking-location">
			<p>Location:<span id="location"> Skype</span></p>
		</div>
		<div class="booking-duration" id="booking-duration-container">

			<button class="booking-time-button booking-button" id="30-min-button">30 min</button>
			<button class="booking-time-button booking-button" id="60-min-button">60 min</button>
			<button class="booking-time-button booking-button" id="90-min-button">90 min</button>
			<button class="booking-time-button booking-button" id="120-min-button">120 min</button>   

			<!--
			<ul class="booking-list">
			    <li class="booking-time-button booking-button">
			        <input type='radio' value='30' name='radio' class="booking-input" id='30min'/>
			        <label for='30min'>30 min</label>
			    </li>
			    <li class="booking-time-button booking-button">
			        <input type='radio' value='60' name='radio' class="booking-input"  id='60min'/>
			        <label for='60min'>60 min</label>
			    </li>
			    <li class="booking-time-button booking-button">
			        <input type='radio' value='90' name='radio' class="booking-input"  id='90min'/>
			        <label for='90min'>90 min</label>
			    </li>
			    <li class="booking-time-button booking-button">
			        <input type='radio' value='120' name='radio' class="booking-input"  id='120min'/>
			        <label for='120min'>120 min</label>
			    </li>
			</ul> -->

			
		</div>
		<div class="booking-date-header">
			<h3>Date of Meeting
				</h1>
		</div>
		<div class="day-arrows">
			<a href="#">
				<i class="fas fa-arrow-left"></i>
			</a>
			<a href="#">
				<i class="fas fa-arrow-right"></i>
			</a>
		</div>
		<div id="booking-calendar">

		</div>

		<div class="booking-time-header">
			<div class="booking-time-title">
				<h3>Meeting Time</h3>
			</div>
			<div class="timezone">
				<h5>Time Zone</h5>
				<select name="DropDownTimezone" id="DropDownTimezone">
					<option value="-12.0">(GMT -12:00) Eniwetok, Kwajalein</option>
					<option value="-11.0">(GMT -11:00) Midway Island, Samoa</option>
					<option value="-10.0">(GMT -10:00) Hawaii</option>
					<option value="-9.0">(GMT -9:00) Alaska</option>
					<option value="-8.0">(GMT -8:00) Pacific Time (US &amp; Canada)</option>
					<option value="-7.0">(GMT -7:00) Mountain Time (US &amp; Canada)</option>
					<option value="-6.0">(GMT -6:00) Central Time (US &amp; Canada), Mexico City</option>
					<option value="-5.0">(GMT -5:00) Eastern Time (US &amp; Canada), Bogota, Lima</option>
					<option value="-4.0">(GMT -4:00) Atlantic Time (Canada), Caracas, La Paz</option>
					<option value="-3.5">(GMT -3:30) Newfoundland</option>
					<option value="-3.0">(GMT -3:00) Brazil, Buenos Aires, Georgetown</option>
					<option value="-2.0">(GMT -2:00) Mid-Atlantic</option>
					<option value="-1.0">(GMT -1:00 hour) Azores, Cape Verde Islands</option>
					<option value="0.0">(GMT) Western Europe Time, London, Lisbon, Casablanca</option>
					<option value="1.0">(GMT +1:00 hour) Brussels, Copenhagen, Madrid, Paris</option>
					<option value="2.0">(GMT +2:00) Kaliningrad, South Africa</option>
					<option value="3.0">(GMT +3:00) Baghdad, Riyadh, Moscow, St. Petersburg</option>
					<option value="3.5">(GMT +3:30) Tehran</option>
					<option value="4.0">(GMT +4:00) Abu Dhabi, Muscat, Baku, Tbilisi</option>
					<option value="4.5">(GMT +4:30) Kabul</option>
					<option value="5.0">(GMT +5:00) Ekaterinburg, Islamabad, Karachi, Tashkent</option>
					<option value="5.5">(GMT +5:30) Bombay, Calcutta, Madras, New Delhi</option>
					<option value="5.75">(GMT +5:45) Kathmandu</option>
					<option value="6.0">(GMT +6:00) Almaty, Dhaka, Colombo</option>
					<option value="7.0">(GMT +7:00) Bangkok, Hanoi, Jakarta</option>
					<option value="8.0">(GMT +8:00) Beijing, Perth, Singapore, Hong Kong</option>
					<option value="9.0">(GMT +9:00) Tokyo, Seoul, Osaka, Sapporo, Yakutsk</option>
					<option value="9.5">(GMT +9:30) Adelaide, Darwin</option>
					<option value="10.0">(GMT +10:00) Eastern Australia, Guam, Vladivostok</option>
					<option value="11.0">(GMT +11:00) Magadan, Solomon Islands, New Caledonia</option>
					<option value="12.0">(GMT +12:00) Auckland, Wellington, Fiji, Kamchatka</option>
				</select>
			</div>
		</div>

		<div class="booking-time">
			<button class="booking-time-selector booking-button">8:00am</button>

			

			<button class="booking-time-selector booking-button">8:30am</button>
			<button class="booking-time-selector booking-button">9:00am</button>
			<button class="booking-time-selector booking-button">9:30am</button>
			<button class="booking-time-selector booking-button">10:00am</button>
			<button class="booking-time-selector booking-button">11:30am</button>
			<button class="booking-time-selector booking-button">12:00pm</button>
			<button class="booking-time-selector booking-button">12:30pm</button>
			<button class="booking-time-selector booking-button">1:00pm</button>
			<button class="booking-time-selector booking-button">1:30pm</button>
			<button class="booking-time-selector booking-button">2:00pm</button>
			<button class="booking-time-selector booking-button">2:30pm</button>
			<button class="booking-time-selector booking-button">3:00pm</button>
			<button class="booking-time-selector booking-button">3:30pm</button>
			<button class="booking-time-selector booking-button">4:00pm</button>
		</div>
	</div>

	<!-- Modal Window after all selections are made -->

	<div class="pre-confirm-modal" id="booking-modal">
		<div class="pre-confirm-title">
			<p class="pre-confirm-title-text">Confirm Your Meeting with <span id="meeting-owener">Brian</span></p>
		</div>
		<div class="pre-confirm-time">
			September 21, 2018 8:30 AM.
		</div>
		<div class="pre-confirm-header-text">
			Both you and <span id="meeting-owener">Brian</span> will get a confirmation email with all the details after you click
			submit.
		</div>
		<div class="pre-confirm-inputs">
			<input type="text" class="signup-inputs" placeholder="Name" name="first-name" required>
			<input type="text" class="signup-inputs" placeholder="Email" name="email" required>
		</div>
		<div class="pre-confirm-buttons">
			<button type="submit" class="signup-button">Submit</button>
			<button type="cancel" class="signup-button" id="pre-confirm-cancel-button">Cancel</button>
		</div>
	</div>

	<script src="https://www.gstatic.com/firebasejs/5.4.2/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-firestore.js"></script>
	<script>

		var config = {
			apiKey: "AIzaSyDJFbbPR1n6if3yX1giV8KvW_Pyq88aBKk",
			authDomain: "calendar-c07dd.firebaseapp.com",
			databaseURL: "https://calendar-c07dd.firebaseio.com",
			projectId: "calendar-c07dd",
			storageBucket: "calendar-c07dd.appspot.com",
			messagingSenderId: "1041934999578"
		};
		firebase.initializeApp(config);
		// Initialize Cloud Firestore through Firebase
		var db = firebase.firestore();
		db.settings({ timestampsInSnapshots: true });

		let entireStartDate = '';
		
		

		db.collection("events").get().then(function (data) {
			data.forEach(function (doc) {
				// doc.data() is never undefined for query doc snapshots


				// console.log(doc.data().end_date.toDate());
				// console.log(doc.data().end_date.toDate().getMonth(), "month");
				// console.log(doc.data().end_date.toDate().getYear(), "year");
				// console.log(doc.data().end_date.toDate().getDay(), "day of week start ");
				// console.log(doc.data().start_date.toDate().getDay(), "day of week end ");
				// console.log(doc.data().start_date.toDate(), "start date");
				// console.log(doc.data().end_date.toDate(), "end date");
				// console.log(doc.data().start_date.toDate().toISOString(), "Iso string start date");
				// console.log(doc.data().end_date.toDate().toISOString(), "Iso string end date");

				// let isoDateStart = doc.data().start_date.toDate().toISOString();
				// let isoDateEnd = doc.data().end_date.toDate().toISOString();
				// let milliseconds = ((new Date(isoDateEnd)) - (new Date(isoDateStart)));

				// let totalMinutes = milliseconds / (60000);
				// let totalScheduleBoxes = totalMinutes / 30;
				// console.log(totalMinutes, "totalMinutes");
				// console.log(totalScheduleBoxes, "total Boxes");


				// let endDate = doc.data().end_date.toDate().toString().slice(7, 10);
				// let startDate = doc.data().start_date.toDate().toString().slice(7, 10);
				// console.log(startDate + " =start date", endDate + " =end date");

				// console.log(doc.data().start_date.toDate().getMinutes(), "start mins");
				// console.log(doc.data().start_date.toDate().getHours(), "start hours");
				// console.log(doc.data().end_date.toDate().getMinutes(), " end mins");
				// console.log(doc.data().end_date.toDate().getHours(), " end hours");
			});
		});
				// using where to get only db collection that meet certain criteria
				// going to add a click event to the day button,
				// and use "this", then with click event run the function below with .where
				// where date == click event date ex..

				// db.collection("events").where("start_date", "==", true)
				// 			.get()
				// 			.then(function(querySnapshot) {
				//     		querySnapshot.forEach(function(doc) {
				//         	// doc.data() is never undefined for query doc snapshots
				//        		 console.log(doc.id, " => ", doc.data());
				//     		});
				// 		})
				// 	.catch(function(error) {
				//   		console.log("Error getting documents: ", error);
				// });

					


		//const dayCalendar = document.getElementById('booking-calendar');
		//const dayButtons = document.getElementsByClassName('booking-day');
		//const timeButtons = document.getElementsByClassName('booking-time');


		// dayCalendar.addEventListener('click', (event) => {
		//   // const isButton = event.target.nodeName === 'BUTTON';
		//   // if (!isButton) {
		//   //   return;
		//   // } 
		//   	console.log(event);
		//   	console.log(event.target.id);
		// 	  let dayButton = event.target.id;
				
			 
		// 	  dayButton.classList.add("active-button");
		// 	  //durationButtonItem.style.border = "1px solid orange";

		// 	  console.log(event.target.id);
			
		// });
		
			

			//bookingTimes.addEventListener('click', (event) => {
		//   // const isButton = event.target.nodeName === 'BUTTON';
		//   // if (!isButton) {
		//   //   return;
		//   // } 
		// 	  const durationButtonItem = event.target.id;
				
		// 	  console.log(durationButtonItem, "dbc");
		// 	  durationButtonItem.classList.add("active-button");
		// 	  //durationButtonItem.style.border = "1px solid orange";

		// 	  console.log(event.target.id);
			
		// })
			// populate time buttons for the day that was clicked

			// 1 figure out what date was clicked
			//		it could be the day, month, or number



			// 2 call db for that date

			// let currentDateReq = db.collection('events');
			// let query = currentDateReq.where('start_date', "==", ??date clicked??)
			// .get()
			// .then(function(querySnapshot) {
			//        querySnapshot.forEach(function(doc) {
			//            //  doc.data() is never undefined for query doc snapshots
			//            console.log(doc.id, " => ", doc.data());
			//        });
			//    })
			//    .catch(function(error) {
			//        console.log("Error getting documents: ", error);
			//    });


			// 3 determine all start and end times for that date

			// 4 create html buttons for times between start and end times

			// 1st button = start hour + start min
			// of start min > 0 && < 30 (
			// 	1st button = start hour + start min = 30)

			// 	if start min > 30 (
			// 		1st button = start hour + 1 + start min = 0)

			// following buttons are 1st button + 30 mins

			// last button - if last button is < end date (last button = none)
			// use for loop to get all the buttons 
			// for(let = startDate; i < endDate; i + 30)
		

		let weekHtml = "";
		const monthNames = ["Jan", "Feb", "Mar", "Apr", "May","Jun","Jul", "Aug", "Sep", "Oct", "Nov","Dec"];

		let d = new Date();
		let weekday = new Array(7);
			weekday[0] = "Sun";
			weekday[1] = "Mon";
			weekday[2] = "Tue";
			weekday[3] = "Wed";
			weekday[4] = "Thur";
			weekday[5] = "Fri";
			weekday[6] = "Sat";

		let newDay = weekday[d.getDay()];
		let currentYear = new Date().getFullYear();	
		
		window.onload = function initWeekCalendar () {
			for (let i = 0; i < 7; i++) {
				
			Date.prototype.addDays = function(days) {
			    let date = new Date(this.valueOf());
			    date.setDate(date.getDate() + days);
			    return date;
			}
			let date = new Date();
			let dayOfWeek = weekday[date.addDays(i).getDay()];
			let dayOfMonth = (date.addDays(i).getMonth() + 1);
				console.log(dayOfMonth);
				console.log(dayOfWeek);

						weekHtml +=
						`<div class="booking-day">
		 					<div class="booking-day-title">${dayOfWeek}</div>
		 						<button class="booking-day-button" data-date=${date.addDays(i).getDate()} data-month=${dayOfMonth} data-year=${currentYear} onclick="addActiveClass(this)">
		 							<div class="booking-day-button-month">${monthNames[dayOfMonth]}</div>
		  							<div class="booking-day-dayOfMonth">${date.addDays(i).getDate()}</div>
		 						</button>
		 				</div>`;

			}
			document.getElementById("booking-calendar").innerHTML = weekHtml;
		}

		



		
		// add class list to buttons clicked
		// const bookingTimes = document.getElementById('booking-duration-container');

		// bookingTimes.addEventListener('click', (event) => {
		//   // const isButton = event.target.nodeName === 'BUTTON';
		//   // if (!isButton) {
		//   //   return;
		//   // } 
		// 	  const durationButtonItem = event.target.id;
				
		// 	  console.log(durationButtonItem, "dbc");
		// 	  durationButtonItem.classList.add("active-button");
		// 	  //durationButtonItem.style.border = "1px solid orange";

		// 	  console.log(event.target.id);
			
		// })

		
		
		//addding class of active to buttons once clicked
		function addActiveClass (el) {
			
			//only allows one element to have active class ....but its only the first element
			if (document.querySelectorAll('#booking-duration-container .active-button').length > 0) {
				// remove active-button class from other elements
				let allElements = document.getElementsByClassName("active-button");
				console.log(allElements);
				for (var i = 0, len = allElements.length; i < len; i++) {
				    let element = allElements[i];
				    console.log(element);
				    element.style.classList.remove("active-button");
			}
		}
			el.className+=' active-button';
			console.log(el);


			let calData = el.dataset.year + "-" + el.dataset.month + "-" + el.dataset.date;
			let start = new Date(calData);
			//let calData = "";
					//let start = "";
					//let start = new Date(calData);
					
					console.log(start , "calData");
			        // let end = new Date('2019-01-01');
			        // console.log(end);


			        
			        this.db.collection('events') //, ref => ref)
			            .where('start_date', '==', start)
			            // .where('start_date', '>', start)
			            // .where('start_date', '<', end)
				            .get()
								.then(function(querySnapshot) {
						    		querySnapshot.forEach(function(doc) {
						        	// doc.data() is never undefined for query doc snapshots
						       		 console.log(doc.id, " => ", doc.data());
						       		 
						       		 console.log(doc.data().start_date, "start time wo todate");
						       		 console.log(doc.data().start_date.toDate().getHours(), "start hours");
						       		 console.log(doc.data().start_date.toDate().getMinutes(), "start mins");
									
						       		 console.log(doc.data().end_date, "end time wo todate");
						       		 console.log(doc.data().end_date.toDate().getHours(), " end hours");
						       		 console.log(doc.data().end_date.toDate().getMinutes(), " end mins");
									
						       		 let x = doc.data().start_date.seconds;
						       		 console.log(x, "x");
						       		 let y = doc.data().end_date.seconds;
						       		 console.log(y, "y");
						       		 let z = y - x;
						       		 console.log(z, "z"); 
					    		});
					})
					.catch(function(error) {
				  		console.log("Error getting documents: ", error);
					});	       
		}


		$(".booking-time-button").click(function() {
			let clicked = $(this);

			  if (clicked.hasClass('active-button')) {
			    $('.booking-time-button').removeClass('disabled'); //enable all again  
			    clicked.removeClass('active-button');
			  } else {
			   $('.booking-time-button').removeClass('active-button');
			    clicked.addClass('active-button');
			    clicked.removeClass('disabled');
			    $('.booking-time-button').not(clicked).addClass('disabled'); //disable everything except clicked element
			  }
			});

		$(".booking-time-selector").click(function() {
			let clicked = $(this);

			  if (clicked.hasClass('active-button')) {
			    $('.booking-time-selector').removeClass('disabled'); //enable all again  
			    clicked.removeClass('active-button');
			  } else {
			   $('.booking-time-selector').removeClass('active-button');
			    clicked.addClass('active-button');
			    clicked.removeClass('disabled');
			    $('.booking-time-selector').not(clicked).addClass('disabled'); //disable everything except clicked element
			  }
		});


		$(".booking-day-button").click(function() {
			$('div').each(function (index) {
				console.log(index + ":" + $(this).text())
			});
			let clicked = $(this);

			console.log("clicked cal");
			
			  if (clicked.hasClass('active-button')) {
			    $('.booking-day-button').removeClass('disabled'); //enable all again  
			    clicked.removeClass('active-button');
			  } else {
			   $('.booking-day-button').removeClass('active-button');
			    clicked.addClass('active-button');
			    clicked.removeClass('disabled');
			    $('.booking-day-button').not(clicked).addClass('disabled'); //disable everything except clicked element
			  }
			});

		// $(".booking-day").find(".button").click(function () {
	 //        alert("hi there");
	 //        return false;
		// });



	</script>
	<script type="text/javascript" src="booking.js"></script>

</body>

</html>